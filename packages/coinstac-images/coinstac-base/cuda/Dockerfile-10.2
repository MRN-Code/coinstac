FROM nvidia/cuda:10.2-base-ubuntu18.04

# Node install start

RUN groupadd --gid 1000 node \
  && useradd --uid 1000 --gid node --shell /bin/bash --create-home node

RUN apt update && apt -y install curl
RUN curl -sL https://deb.nodesource.com/setup_12.x -o nodesource_setup.sh \
  && bash nodesource_setup.sh \
  && apt-get update \
  && apt -y install nodejs \
  && ln -s /usr/local/bin/node /usr/local/bin/nodejs

  ADD . /server
  WORKDIR /server
  RUN npm i --production
  CMD ["node", "/server/index.js"]

RUN apt -y install python3-pip
RUN rm /usr/bin/python \
  && ln -s /usr/bin/python3.6 /usr/bin/python \
  && ln -s /usr/bin/pip3 /usr/bin/pip

